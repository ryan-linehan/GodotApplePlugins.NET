// <auto-generated>
// This code was generated by GodotApplePlugins.Generator.
// Do not edit this file directly. Edit the generator instead.
// </auto-generated>

#nullable enable

using Godot;
using System;
using System.Linq;
using System.Threading.Tasks;

namespace GodotApplePlugins.NET.StoreKit;

/// <summary>
/// A view for redeeming subscription offers.
/// </summary>
public partial class SubscriptionOfferView : GodotObject
{
    #region StringName Constants

    private static readonly StringName _methodDismiss = "dismiss";
    private static readonly StringName _methodPresent = "present";
    private static readonly StringName _propertyTitle = "title";
    private static readonly StringName _signalError = "error";
    private static readonly StringName _signalSuccess = "success";

    #endregion

    private readonly GodotObject _instance;

    /// <summary>
    /// Creates a new SubscriptionOfferView wrapper.
    /// </summary>
    public SubscriptionOfferView(GodotObject instance)
    {
        _instance = instance ?? throw new ArgumentNullException(nameof(instance));
        ConnectSignals();
    }

    /// <summary>
    /// Gets the underlying GDExtension object.
    /// </summary>
    public GodotObject Instance => _instance;

    /// <summary>
    /// The title displayed on the view.
    /// </summary>
    public string Title
    {
        get => _instance.Get(_propertyTitle).AsString();
        set => _instance.Set(_propertyTitle, value);
    }

    /// <summary>
    /// Dismisses the currently presented view.
    /// </summary>
    public void Dismiss()
    {
        _instance.Call(_methodDismiss);
    }

    /// <summary>
    /// Presents the offer code redemption view. note: The `callback` parameter is currently unused; use the success and error signals to handle the result.
    /// </summary>
    public void Present(Action? callback = null)
    {
        _instance.Call(_methodPresent, callback != null ? Callable.From(() => callback()) : Callable.From(() => { }));
    }

    #region Signals

    /// <summary>
    /// Emitted when the offer redemption fails. `arg1` contains the error message.
    /// </summary>
    [Signal]
    public delegate void ErrorEventHandler(string message);

    /// <summary>
    /// Emitted when the offer redemption is successful.
    /// </summary>
    [Signal]
    public delegate void SuccessEventHandler();

    private void ConnectSignals()
    {
        _instance.Connect(_signalError,
            Callable.From<string>((p0) =>
                EmitSignal(SignalName.Error, p0)));

        _instance.Connect(_signalSuccess,
            Callable.From(() => EmitSignal(SignalName.Success)));

    }

    #endregion
}
