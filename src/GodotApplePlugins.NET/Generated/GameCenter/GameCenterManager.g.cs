// <auto-generated>
// This code was generated by GodotApplePlugins.Generator.
// Do not edit this file directly. Edit the generator instead.
// </auto-generated>

#nullable enable

using Godot;
using System;
using System.Linq;
using System.Threading.Tasks;

namespace GodotApplePlugins.NET.GameCenter;

/// <summary>
/// Entry point for authenticating the Apple Game Center local player.
/// </summary>
public partial class GameCenterManager : GodotObject
{
    #region StringName Constants

    private static readonly StringName _methodAuthenticate = "authenticate";
    private static readonly StringName _propertyAccessPoint = "access_point";
    private static readonly StringName _propertyLocalPlayer = "local_player";
    private static readonly StringName _signalAuthenticationError = "authentication_error";
    private static readonly StringName _signalAuthenticationResult = "authentication_result";

    #endregion

    private readonly GodotObject _instance;

    /// <summary>
    /// Creates a new GameCenterManager wrapper.
    /// </summary>
    public GameCenterManager(GodotObject instance)
    {
        _instance = instance ?? throw new ArgumentNullException(nameof(instance));
        ConnectSignals();
    }

    /// <summary>
    /// Gets the underlying GDExtension object.
    /// </summary>
    public GodotObject Instance => _instance;

    /// <summary>
    /// Access the shared [GKAccessPoint] object to manage the visibility and state of the Game Center access point.
    /// </summary>
    public GKAccessPoint AccessPoint
    {
        get => new GKAccessPoint((GodotObject)_instance.Get(_propertyAccessPoint).Obj!);
        set => _instance.Set(_propertyAccessPoint, value.Instance);
    }

    /// <summary>
    /// Returns the wrapper for [code skip-lint]GKLocalPlayer.local[/code]. Use this after successful authentication to call methods such as [code]load_friends()[/code] or [code]fetch_items_for_identity_verification_signature()[/code].
    /// </summary>
    public GKLocalPlayer LocalPlayer
    {
        get => new GKLocalPlayer((GodotObject)_instance.Get(_propertyLocalPlayer).Obj!);
        set => _instance.Set(_propertyLocalPlayer, value.Instance);
    }

    /// <summary>
    /// Triggers [code skip-lint]GKLocalPlayer.authenticateHandler', presenting Apple's login sheet when needed. Emits authentication_result with the new status and authentication_error if GameKit reports a failure.
    /// </summary>
    public void Authenticate()
    {
        _instance.Call(_methodAuthenticate);
    }

    /// <summary>
    /// Async version of Authenticate that awaits the AuthenticationResult signal.
    /// </summary>
    public async Task<bool> AuthenticateAsync()
    {
        _instance.Call(_methodAuthenticate);
        var result = await ToSignal(this, SignalName.AuthenticationResult);
        return result[0].AsBool();
    }

    #region Signals

    /// <summary>
    /// Emitted whenever GameKit authentication fails. The argument is the localized error string provided by Apple.
    /// </summary>
    [Signal]
    public delegate void AuthenticationErrorEventHandler(string message);

    /// <summary>
    /// Emitted after [code skip-lint]authenticate()' finishes. The boolean is 'true' when [code skip-lint]GKLocalPlayer.local.isAuthenticated' reports success.
    /// </summary>
    [Signal]
    public delegate void AuthenticationResultEventHandler(bool status);

    private void ConnectSignals()
    {
        _instance.Connect(_signalAuthenticationError,
            Callable.From<string>((p0) =>
                EmitSignal(SignalName.AuthenticationError, p0)));

        _instance.Connect(_signalAuthenticationResult,
            Callable.From<bool>((p0) =>
                EmitSignal(SignalName.AuthenticationResult, p0)));

    }

    #endregion
}
