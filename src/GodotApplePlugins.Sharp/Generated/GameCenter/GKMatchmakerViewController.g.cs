// <auto-generated>
// This code was generated by GodotApplePlugins.Generator.
// Do not edit this file directly. Edit the generator instead.
// </auto-generated>

#nullable enable

using Godot;
using System;
using System.Linq;
using System.Threading.Tasks;

namespace GodotApplePlugins.NET.GameCenter;

/// <summary>
/// Presents Apple's Game Center matchmaking UI.
/// </summary>
public partial class GKMatchmakerViewController : GodotObject
{
    private readonly GodotObject _instance;

    /// <summary>
    /// Creates a new GKMatchmakerViewController wrapper.
    /// </summary>
    public GKMatchmakerViewController(GodotObject instance)
    {
        _instance = instance ?? throw new ArgumentNullException(nameof(instance));
        ConnectSignals();
    }

    /// <summary>
    /// Gets the underlying GDExtension object.
    /// </summary>
    public GodotObject Instance => _instance;

    /// <summary>
    /// Builds a wrapper around Apple's view controller for the supplied [code skip-lint]GKMatchRequest'. Configure the returned object and call present to display it.
    /// </summary>
    public GKMatchmakerViewController CreateController(GKMatchRequest request)
    {
        var result = _instance.Call(new StringName("create_controller"), request.Instance);
        return new GKMatchmakerViewController((GodotObject)result.Obj!);
    }

    /// <summary>
    /// Presents the previously created view controller, handling both UIKit and AppKit dialog flows.
    /// </summary>
    public void Present()
    {
        _instance.Call(new StringName("present"));
    }

    /// <summary>
    /// Shows the matchmaking UI and invokes the callback with '(GKMatch match, Variant error)' where only one argument is non-'null'. Errors are reported as strings such as "cancelled" when the user dismisses the sheet.
    /// </summary>
    public void RequestMatch(GKMatchRequest request, Action? callback = null)
    {
        _instance.Call(new StringName("request_match"), request.Instance, callback != null ? Callable.From(() => callback()) : Callable.From(() => { }));
    }

    #region Signals

    /// <summary>
    /// Emitted when the user cancels the matchmaking UI. The string is empty on UIKit and contains an informational message on macOS.
    /// </summary>
    [Signal]
    public delegate void CancelledEventHandler(string detail);

    /// <summary>
    /// Fired when GameKit returns players for a hosted-server scenario. The array contains [code skip-lint]GKPlayer' instances.
    /// </summary>
    [Signal]
    public delegate void DidFindHostedPlayersEventHandler(Godot.Collections.Array players);

    /// <summary>
    /// Triggered when a peer-to-peer match has been found and is ready to start.
    /// </summary>
    [Signal]
    public delegate void DidFindMatchEventHandler(GKMatch match);

    /// <summary>
    /// Emitted if Apple reports an error while matchmaking. The string contains 'localizedDescription'.
    /// </summary>
    [Signal]
    public delegate void FailedWithErrorEventHandler(string message);

    private void ConnectSignals()
    {
        _instance.Connect(new StringName("cancelled"),
            Callable.From<string>((p0) =>
                EmitSignal(SignalName.Cancelled, p0)));

        _instance.Connect(new StringName("did_find_hosted_players"),
            Callable.From<Godot.Collections.Array>((p0) =>
                EmitSignal(SignalName.DidFindHostedPlayers, p0)));

        _instance.Connect(new StringName("did_find_match"),
            Callable.From<GodotObject>((p0) =>
                EmitSignal(SignalName.DidFindMatch, new GKMatch(p0))));

        _instance.Connect(new StringName("failed_with_error"),
            Callable.From<string>((p0) =>
                EmitSignal(SignalName.FailedWithError, p0)));

    }

    #endregion
}
