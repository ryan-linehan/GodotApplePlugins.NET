// <auto-generated>
// This code was generated by GodotApplePlugins.Generator.
// Do not edit this file directly. Edit the generator instead.
// </auto-generated>

#nullable enable

using Godot;
using System;
using System.Linq;
using System.Threading.Tasks;
using GodotApplePlugins.NET.Foundation;

namespace GodotApplePlugins.NET.UI;

/// <summary>
/// Provides access to the operating system file picker, on iOS, this provides access to sandboxed content.
/// </summary>
public partial class AppleFilePicker : GodotObject
{
    #region StringName Constants

    private static readonly StringName _methodPickDocument = "pick_document";
    private static readonly StringName _signalCanceled = "canceled";
    private static readonly StringName _signalFileSelected = "file_selected";
    private static readonly StringName _signalFilesSelected = "files_selected";

    #endregion

    private readonly GodotObject _instance;

    /// <summary>
    /// Creates a new AppleFilePicker wrapper.
    /// </summary>
    public AppleFilePicker(GodotObject instance)
    {
        _instance = instance ?? throw new ArgumentNullException(nameof(instance));
        ConnectSignals();
    }

    /// <summary>
    /// Gets the underlying GDExtension object.
    /// </summary>
    public GodotObject Instance => _instance;

    /// <summary>
    /// Opens the file picker. allowed_types should be an array of strings representing the file extensions or UTTypes you want to allow (e.g. '["txt", "png"]' or '["public.plain-text"]'). allow_multiple if true, allows selecting multiple files. Results will be emitted via the files_selected signal. If false (default), results are emitted via file_selected.
    /// </summary>
    public void PickDocument(string[] allowedTypes, bool allowMultiple)
    {
        _instance.Call(_methodPickDocument, new Godot.Collections.Array(allowedTypes.Select(x => Variant.From(x))), allowMultiple);
    }

    #region Signals

    /// <summary>
    /// Emitted when the picker is canceled by the user.
    /// </summary>
    [Signal]
    public delegate void CanceledEventHandler();

    /// <summary>
    /// Emitted when a single file is selected (when 'allow_multiple' is false).
    /// </summary>
    [Signal]
    public delegate void FileSelectedEventHandler(AppleURL url, string path);

    /// <summary>
    /// Emitted when multiple files are selected (when 'allow_multiple' is true).
    /// </summary>
    [Signal]
    public delegate void FilesSelectedEventHandler(AppleURL[] urls, string[] paths);

    private void ConnectSignals()
    {
        _instance.Connect(_signalCanceled,
            Callable.From(() => EmitSignal(SignalName.Canceled)));

        _instance.Connect(_signalFileSelected,
            Callable.From<GodotObject, string>((p0, p1) =>
                EmitSignal(SignalName.FileSelected, new AppleURL(p0), p1)));

        _instance.Connect(_signalFilesSelected,
            Callable.From<Godot.Collections.Array, string[]>((p0, p1) =>
                EmitSignal(SignalName.FilesSelected, p0.Select(x => new AppleURL((GodotObject)x.Obj!)).ToArray(), p1)));

    }

    #endregion
}
