// <auto-generated>
// This code was generated by GodotApplePlugins.Generator.
// Do not edit this file directly. Edit the generator instead.
// </auto-generated>

#nullable enable

using Godot;
using System;
using System.Linq;

namespace GodotApplePlugins.Sharp.Authentication;

/// <summary>
/// Presents a secure web-based authentication flow (OAuth) using the system browser.
/// </summary>
public partial class ASWebAuthenticationSession
{
    private readonly GodotObject _instance;

    /// <summary>
    /// Creates a new ASWebAuthenticationSession wrapper.
    /// </summary>
    public ASWebAuthenticationSession(GodotObject instance)
    {
        _instance = instance ?? throw new ArgumentNullException(nameof(instance));
        ConnectSignals();
    }

    /// <summary>
    /// Gets the underlying GDExtension object.
    /// </summary>
    public GodotObject Instance => _instance;

    /// <summary>
    /// Starts the authentication session. auth_url is the provider authorization URL. callback_scheme is your app's callback URL scheme (pass an empty string to not restrict). prefers_ephemeral controls whether the session uses an ephemeral browser session. Returns 'true' if the session started.
    /// </summary>
    public bool Start(string authUrl, string callbackScheme, bool prefersEphemeral)
    {
        var result = _instance.Call(new StringName("start"), authUrl, callbackScheme, prefersEphemeral);
        return result.AsBool();
    }

    /// <summary>
    /// Cancels the running authentication session (if any).
    /// </summary>
    public void Cancel()
    {
        _instance.Call(new StringName("cancel"));
    }

    #region Signals

    /// <summary>
    /// Emitted when the authentication session completes successfully. callback_url is the full callback URL as a string.
    /// </summary>
    public event Action<string>? Completed;

    /// <summary>
    /// Emitted when the authentication session fails. message is the localized error description.
    /// </summary>
    public event Action<string>? Failed;

    /// <summary>
    /// Emitted when the user cancels the authentication UI.
    /// </summary>
    public event Action? Canceled;

    private void ConnectSignals()
    {
        _instance.Connect(new StringName("completed"),
            Callable.From<string>((p0) =>
                Completed?.Invoke(p0)));

        _instance.Connect(new StringName("failed"),
            Callable.From<string>((p0) =>
                Failed?.Invoke(p0)));

        _instance.Connect(new StringName("canceled"),
            Callable.From(() => Canceled?.Invoke()));

    }

    #endregion
}
