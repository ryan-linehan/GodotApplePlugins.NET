<?xml version="1.0" encoding="UTF-8" ?>
<class name="StoreKitManager" inherits="RefCounted" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="https://raw.githubusercontent.com/godotengine/godot/master/doc/class.xsd">
	<brief_description>
		Manages StoreKit interactions such as requesting products, purchasing, and restoring purchases.
	</brief_description>
	<description>
		This class handles the core StoreKit functionality. It provides methods to fetch product information from the App Store, initiate purchases,
		        restore previous purchases and be notified of the current status of the purchase upon startup.

		                Once you instantiate this class, connect to the the [signal transaction_updated] signal to
		                get notification related to the status of your purchases - these are delivered to notify
		                your application of what products your user is entitled to at startup.   If you are using
		                Apple's PurchaseIntent, you will also want to connect to the [signal purchase_intent].

						The [signal transaction_updated] is only raised for verified transactions.   
						Apple also supports unverified transactions, those are posted to the [signal unverified_transaction_updated] signal 
						and in addition to the transaction they contains a status code from the [enum VerificationError].

		                After you have set up your signals, you are ready to receive those events.

		                In addition, when you call the [method purchase] or [method purchase_with_options] you will
		                want to setup a handler for the [signal purchase_completed] signal which is raised in
		                response to different events during the purchasing.
	</description>
	<tutorials>
	</tutorials>
	<methods>
		<method name="fetch_current_entitlements">
			<return type="void" />
			<description>
				The current entitlements sequence provides the most recent transaction for each product the customer is entitled to, use this
				to refresh the list of features the user is entitled to.

				Specifically, it includes:

				* One transaction for each non-consumable In-App Purchase
				* The latest transaction for each auto-renewable subscription whose Product.SubscriptionInfo.RenewalState is either subscribed or inGracePeriod
				* The latest transaction for each non-renewing subscription, including those that have ended
				* Products that have been refunded or revoked by the App Store are excluded from the current entitlements, as are consumable In-App Purchases. To retrieve transactions for unfinished consumables, use the unfinished or all transaction sequences instead.
			</description>
		</method>
		<method name="purchase">
			<return type="void" />
			<param index="0" name="product" type="StoreProduct" />
			<description>
				Initiates the purchase of a specific product, e.g. [code]purchase(product)[/code].   This will raise the
				                [signal purchase_completed] signal, either to indicate that an error took place, or the status of the
				                purchase.
			</description>
		</method>
		<method name="purchase_with_options">
			<return type="void" />
			<param index="0" name="product" type="StoreProduct" />
			<param index="1" name="options" type="Array[StoreProductPurchaseOption]" />
			<description>
				Initiates the purchase of a specific product, e.g. [code]purchase(product)[/code], and allows you to provide additional purchase options.
				                This will raise the
				                [signal purchase_completed] signal, either to indicate that an error took place, or the status of the
				                purchase.
			</description>
		</method>
		<method name="request_products">
			<return type="void" />
			<param index="0" name="productIds" type="PackedStringArray" />
			<description>
				Requests product information for a list of product identifiers, e.g. [code]request_products(["com.example.product1", "com.example.product2"])[/code].
				                This method will raise the [signal products_request_completed] signal when the information is retrieved.
			</description>
		</method>
		<method name="restore_purchases">
			<return type="void" />
			<description>
				Restores previously purchased non-consumable products and auto-renewable subscriptions.   This will raise the
				                [signal restore_completed] signal when the product purchased have been restored.
			</description>
		</method>
	</methods>
	<signals>
		<signal name="products_request_completed">
			<param index="0" name="products" type="Array[StoreProduct]" />
			<param index="1" name="status" type="int" />
			<description>
				Emitted when a product request completes.
				                [param products] is an Array of [StoreProduct]s (or nulls).
				                [param status] indicates success or failure.
			</description>
		</signal>
		<signal name="purchase_completed">
			<param index="0" name="transaction" type="StoreTransaction" />
			<param index="1" name="status" type="int" />
			<param index="2" name="message" type="String" />
			<description>
				Emitted when a purchase completes.
				                [param transaction] is the [StoreTransaction] on success.
				                [param status] indicates the result (OK, cancelled, invalid product, etc.).
				                [param error_message] contains error details if failed.
			</description>
		</signal>
		<signal name="purchase_intent">
			<param index="0" name="product" type="StoreProduct" />
			<description>
			</description>
		</signal>
		<signal name="restore_completed">
			<param index="0" name="status" type="int" />
			<param index="1" name="message" type="String" />
			<description>
				Emitted when the restore process completes. `arg1` is the [enum StoreKitStatus], and `arg2` is an error message if applicable.
			</description>
		</signal>
		<signal name="supscription_update">
			<param index="0" name="status" type="StoreSubscriptionInfoStatus" />
			<description>
			</description>
		</signal>
		<signal name="transaction_updated">
			<param index="0" name="transaction" type="StoreTransaction" />
			<description>
				Emitted when a transaction is updated (e.g., a subscription renews or a purchase is approved externally). `transaction` is the updated [StoreTransaction].

				You must call the finished method on the transaction once you have made sure that you have delivered the content to the user.
			</description>
		</signal>
		<signal name="unverified_transaction_updated">
			<param index="0" name="transaction" type="StoreTransaction" />
			<param index="1" name="verification_error" type="int" />
			<description>
			</description>
		</signal>
	</signals>
	<constants>
		<constant name="OK" value="0" enum="StoreKitStatus">
			The operation completed successfully.
		</constant>
		<constant name="INVALID_PRODUCT" value="1" enum="StoreKitStatus">
			The product identifier is invalid.
		</constant>
		<constant name="CANCELLED" value="2" enum="StoreKitStatus">
			The operation was cancelled.
		</constant>
		<constant name="UNVERIFIED_TRANSACTION" value="3" enum="StoreKitStatus">
			The transaction could not be verified.
		</constant>
		<constant name="USER_CANCELLED" value="4" enum="StoreKitStatus">
			The user cancelled the operation.
		</constant>
		<constant name="PURCHASE_PENDING" value="5" enum="StoreKitStatus">
			The purchase is pending (e.g., waiting for parental approval).
		</constant>
		<constant name="UNKNOWN_STATUS" value="6" enum="StoreKitStatus">
			An unknown status occurred.
		</constant>
		<constant name="REVOKED_CERTIFICATE" value="0" enum="VerificationError">
			The certificate chain was parsable, but was invalid due to one or more revoked certificates.
		</constant>
		<constant name="INVALID_CERTIFICATE_CHAIN" value="1" enum="VerificationError">
			The certificate chain was parsable, but it was invalid for signing this data.
		</constant>
		<constant name="INVALID_DEVICE_VERIFICATION" value="2" enum="VerificationError">
			The device verification properties were invalid for this device.
		</constant>
		<constant name="INVALID_ENCODING" value="3" enum="VerificationError">
			Th JWS header and any data included in it or it's certificate chain had an invalid encoding.
		</constant>
		<constant name="INVALID_SIGNATURE" value="4" enum="VerificationError">
			The certificate chain was valid for signing this data, but the leaf's public key was invalid for the JWS signature.
		</constant>
		<constant name="MISSING_REQUIRED_PROPERTIES" value="5" enum="VerificationError">
			Either the JWS header or any certificate in the chain was missing necessary properties for verification.
		</constant>
		<constant name="OTHER" value="6" enum="VerificationError">
			A new error code was introduced that was not previously handled.
		</constant>
	</constants>
</class>
